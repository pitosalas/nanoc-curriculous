#Srequire 'pry'
require_relative "rake/rake_helper"
prep_cleanlist

verify_environment

#  RAKE TASKS BEGIN HERE

desc "Print out help for this rakefile"
task :default => [:help]

desc "Print out help text to use this rakefile"
task :help do
	show_help
end

namespace 'conf' do
	desc "Declare associated content directory"
	task :declare do |t, args|
		content_dir = ENV['dir']
		fail "Specify content directory with dir='/my/dir'" if content_dir.nil?
		if File.exist?(CONF_FILE_PATH)
			puts "[Overwriting previous local config file at '#{CONF_FILE_PATH}']"
		end
		write_config_file(content_dir)
		write_runtime_config
	end

	desc "Check Configuration settings"
	task :check do
		puts (config_ok? ? "Ok." : "Config invalid.")
	end

	desc "Display Configuration settings"
	task :show do
		puts "Curriculous Configuration:\n"
		puts "  Content path:              #{CONTENT_PATH}"
		puts "  Target AWS Bucket:         #{AWS_BUCKET}"
		puts "  Related Topics directory:  #{TOPICS_DIR}"
		puts "  Copyright string:          \"#{COPYRIGHT_STRING}\""
	end
end

namespace 'stage' do

  desc "reset local state. Delete all content, layouts and topics"
  task :reset do

  end

	desc "grab files from authoring directories into staging area"
	task :grab do
	end

	desc "ungrab (return) files back to authoring directories"
	task :ungrab do
	end
end

namespace 'nanoc' do
	desc "compile course locally"
	task :compile do
		sh "nanoc compile"
	end

	desc "run local server"
	task :serve do
		sh "nanoc view"
	end

	desc "recompile automatically"
	task :guard do
		sh "guard -i"
	end

	desc "view in browser"
	task :view do
		sh "open http://0.0.0.0:3000"
	end
end

